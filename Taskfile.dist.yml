version: '3'

tasks:
  generate:
    desc: create generated code
    cmds:
    - go generate ./...
    - task: mocks

  mocks:
    internal: true
    dir: internal
    cmds:
    - mockery --all --inpackage --disable-version-string --with-expecter

  smokes:
    desc: run smoke tests against dummyjson.com
    cmds:
    - go build
    - defer: rm poke
    - ./poke --debug hack/dummyjson_seq.yaml

  protos:
    desc: generate protobuf bits
    dir: functionaltests/echoserver
    cmds:
    - protoc -I./protos/ --go_out=protobuf/ --go_opt=paths=source_relative --go-grpc_out=protobuf/ --go-grpc_opt=paths=source_relative protos/*.proto
